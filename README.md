# Parallel Programming

**Åbo Akademi University, Information Technology Department**

**Instructor: Alireza Olama**

## Homework Assignment 2: Optimizing Matrix Multiplication in C++

**Due Date**: 08/05/2025

**Points**: 100

---

### 1. Blocked Matrix Multiplication Pseudocode

**Task**: Implement the `blocked_matmul` function in the provided `main.cpp`. Experiment with different block sizes (e.g.,
16, 32, 64) and report the best performance.

- Best block size performance varied, but block size 32 performed better than 16 and 64 because 32 showed better consistency than 16 and 64. 
- Small matrices (ex: 64x64x64) showed minimal improvement due to overhead.

---

### 2. Parallel Matrix Multiplication with OpenMP

**Task**: Implement the `parallel_matmul` function in the provided `main.cpp` using `OpenMP`. Test with different numbers of
threads (e.g., 2, 4, 8) by setting the environment variable `OMP_NUM_THREADS`.

- The performance result is in section 3 (Performance Measurement) with 3 different threads (2, 4, and 8).
- Parallel implementation achieved 3-6× speedup over naive implementation for larger matrices.
- Smaller matrices sometimes showed less benefit or even slowdown due to parallel overhead

---

### 3. Performance Measurement

#### Block size = 16, OMP_NUM_THREADS = 2

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0              | 0.000999928      | 0.000999928       | 0×              | 0×               |
| 1         | 128 x 64 x 128         | 0.00299978     | 0.00200009       | 0.00199986        | 1.49982x        | 1.5x             |
| 2         | 100 x 128 x 56         | 0.000999928    | 0.00200009       | 0.00200009        | 0.49994x        | 0.49994x         |
| 3         | 128 x 64 x 128         | 0.00200009     | 0.00199986       | 0.000999928       | NaN             | 0x               |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.543             | 2.38×           | 4.32×            |
| 5         | 200 x 100 x 256        | 0.0119998      | 0.016            | 0.00399995        | 0.749989x       | 3×               |
| 6         | 256 x 256 x 256        | 0.0370002      | 0.05             | 0.00699997        | 0.740004x       | 5.28576x         |
| 7         | 256 x 300 x 256        | 0.0450001      | 0.059            | 0.00999999        | 0.762713x       | 4.50001x         |
| 8         | 64 x 128 x 64          | 0.00199986     | 0.00100017       | 0.00199986        | 1.99952x        | 1x               |
| 9         | 256 x 256 x 257        | 0.036          | 0.049            | 0.00700021        | 0.734694x       | 5.14271x         |

#### Block size = 16, OMP_NUM_THREADS = 4

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.000999928    | 0.000999928      | 0.000999928       | 1×              | 1×               |
| 1         | 128 x 64 x 128         | 0.00399995     | 0.00300002       | 0.00099992        | 1.33331x        | 4.00024x         |
| 2         | 100 x 128 x 56         | 0.00199986     | 0.00199986       | 0.00200009        | 1x              | 0.999881x        |
| 3         | 128 x 64 x 128         | 0.00200009     | 0.00300002       | 0.000999928       | 0.666693x       | 2.00024x         |
| 4         | 32 x 128 x 32          | 0              | 0.000999928      | 0.000999928       | 0×              | 0x               |
| 5         | 200 x 100 x 256        | 0.0149999      | 0.016            | 0.00399995        | 0.93749x        | 3.75001x         |
| 6         | 256 x 256 x 256        | 0.0370002      | 0.05             | 0.00699997        | 0.740004x       | 5.28576x         |
| 7         | 256 x 300 x 256        | 0.0440001      | 0.0599999        | 0.0100002         | 0.733337x       | 4.39991x         |
| 8         | 64 x 128 x 64          | 0.00100017     | 0.00300002       | 0.00199986        | 0.333386x       | 0.500119x        |
| 9         | 256 x 256 x 257        | 0.036          | 0.053            | 0.00900006        | 0.679246x       | 3.99997x        |

#### Block size = 16, OMP_NUM_THREADS = 8

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.000999928    | 0.000999928      | 0.00200009        | 1×              | 0.49994x         |
| 1         | 128 x 64 x 128         | 0.00199986     | 0.00300002       | 0.00100017        | 0.666614x       | 1.99952x         |
| 2         | 100 x 128 x 56         | 0.00200009     | 0.00200009       | 0.00199986        | 1x              | 1.00012x         |
| 3         | 128 x 64 x 128         | 0.00300002     | 0.00300002       | 0.000999928       | 1x              | 3.00024x         |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.000999928       | NaN             | 0x               |
| 5         | 200 x 100 x 256        | 0.0120001      | 0.026            | 0.00300002        | 0.461541x       | 4x               |
| 6         | 256 x 256 x 256        | 0.0380001      | 0.05             | 0.0079999         | 0.760003x       | 4.75007x         |
| 7         | 256 x 300 x 256        | 0.0450001      | 0.0609999        | 0.00900006        | 0.737708x       | 4.99997x         |
| 8         | 64 x 128 x 64          | 0.000999928    | 0.00200009       | 0.00300002        | 0.49994x        | 0.333307x        |
| 9         | 256 x 256 x 257        | 0.0349998      | 0.0519998        | 0.00699997        | 0.673076x       | 5x               |

#### Block size = 32, OMP_NUM_THREADS = 2

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.00100017     | 0.00100017       | 0.00200009        | 1x              | 0.50006x         |
| 1         | 128 x 64 x 128         | 0.00200009     | 0.00199986       | 0.00199986        | 1.00012x        | 1.00012x         |
| 2         | 100 x 128 x 56         | 0.00199986     | 0.00100017       | 0.00100017        | 1.99952x        | 1.99952x         |
| 3         | 128 x 64 x 128         | 0.00300002     | 0.00300002       | 0.00100017        | 1x              | 2.99952x         |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.00200009        | NaN             | 0x               |
| 5         | 200 x 100 x 256        | 0.0109999      | 0.0149999        | 0.00199986        | 0.733334x       | 5.50036x         |
| 6         | 256 x 256 x 256        | 0.0380001      | 0.04             | 0.00600004        | 0.950004x       | 6.33331x         |
| 7         | 256 x 300 x 256        | 0.0470002      | 0.0500002        | 0.00900006        | 0.94x           | 5.2222x          |
| 8         | 64 x 128 x 64          | 0.00100017     | 0.000999928      | 0.00299978        | 1.00024x        | 0.333413x        |
| 9         | 256 x 256 x 257        | 0.0350001      | 0.0410001        | 0.00699997        | 0.853658x       | 5.00003x         |

#### Block size = 32, OMP_NUM_THREADS = 4

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0              | 0.000999928      | 0.000999928       | 0×              | 0×               |
| 1         | 128 x 64 x 128         | 0.00300002     | 0.00199986       | 0.00300002        | 1.50012x        | 1x               |
| 2         | 100 x 128 x 56         | 0.00199986     | 0.00100017       | 0.00199986        | 1.99952x        | 1x               |
| 3         | 128 x 64 x 128         | 0.00300002     | 0.00300002       | 0.00300002        | 1x              | 1x               |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.00199986        | NaN             | 0x               |
| 5         | 200 x 100 x 256        | 0.0120001      | 0.013            | 0.00299978        | 0.923083x       | 4.00032x         |
| 6         | 256 x 256 x 256        | 0.0379999      | 0.0420001        | 0.00800014        | 0.904758x       | 4.7499x          |
| 7         | 256 x 300 x 256        | 0.043          | 0.0479999        | 0.00800014        | 0.895836x       | 5.37491x         |
| 8         | 64 x 128 x 64          | 0.00100017     | 0.000999928      | 0.00300002        | 0.999762x       | 0.333307x        |
| 9         | 256 x 256 x 257        | 0.0369999      | 0.046            | 0.0079999         | 0.804346x       | 4.62505x         |

#### Block size = 32, OMP_NUM_THREADS = 8

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.000999928    | 0.000999928      | 0.00200009        | 1x              | 0.49994x         |
| 1         | 128 x 64 x 128         | 0.00200009     | 0.00200009       | 0.00200009        | 1x              | 1x               |
| 2         | 100 x 128 x 56         | 0.00199986     | 0.000999928      | 0.00399995        | 2x              | 0.49997x         |
| 3         | 128 x 64 x 128         | 0.00200009     | 0.00300002       | 0.00300002        | 0.666693x       | 0.666693x        |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.00100017        | NaN             | 0x               |
| 5         | 200 x 100 x 256        | 0.0120001      | 0.0129998        | 0.00400019        | 0.923099x       | 2.99988x         |
| 6         | 256 x 256 x 256        | 0.0380001      | 0.0420001        | 0.00900006        | 0.904763x       | 4.2222x          |
| 8         | 64 x 128 x 64          | 0.000999928    | 0.00100017       | 0.00300002        | 0.999762x       | 0.333307x        |
| 9         | 256 x 256 x 257        | 0.0370002      | 0.0440001        | 0.00699997        | 0.84091x        | 5.28576x         |

#### Block size = 64, OMP_NUM_THREADS = 2

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.00100017     | 0.000999928      | 0.000999928       | 1.00024x        | 1.00024x         |
| 1         | 128 x 64 x 128         | 0.00200009     | 0.00299978       | 0.00199986        | 0.666746x       | 1.00012x         |
| 2         | 100 x 128 x 56         | 0.000999928    | 0.00199986       | 0.00199986        | 0.5x            | 0.5x             |
| 3         | 128 x 64 x 128         | 0.00199986     | 0                | 0                 | inf             | inf              |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.00100017        | NaN             | 0x               |
| 5         | 200 x 100 x 256        | 0.0150001      | 0                | 0.013             | inf             | 1.15385x         |
| 6         | 256 x 256 x 256        | 0.0479999      | 0.0469999        | 0                 | 1.02128x        | inf              |
| 7         | 256 x 300 x 256        | 0.033          | 0.046            | 0                 | 0.717391x       | inf              |
| 8         | 64 x 128 x 64          | 0              | 0.000999928      | 0.016             | 0×              | 0×               |
| 9         | 256 x 256 x 257        | 0.0309999      | 0.0320001        | 0.0139999         | 0.968745x       | 2.21429x         |

#### Block size = 64, OMP_NUM_THREADS = 4

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.0150001      | 0.000999928      | 0                 | 15.0012x        | infx             |
| 1         | 128 x 64 x 128         | 0.00200009     | 0.0149999        | 0.00499988        | 0.133341x       | 0.400029x        |
| 2         | 100 x 128 x 56         | 0              | 0.000999928      | 0                 | 0×              | NaNx             |
| 3         | 128 x 64 x 128         | 0.00900006     | 0                | 0                 | infx            | infx             |
| 4         | 32 x 128 x 32          | 0              | 0                | 0                 | NaN             | NaN              |
| 5         | 200 x 100 x 256        | 0.016          | 0.0150001        | 0                 | 1.06666x        | infx             |
| 6         | 256 x 256 x 256        | 0.0480001      | 0.043            | 0                 | 1.11628x        | infx             |
| 7         | 256 x 300 x 256        | 0.046          | 0.0479999        | 0.0190001         | 0.958336x       | 2.42105x         |
| 8         | 64 x 128 x 64          | 0.00200009     | 0.000999928      | 0                 | 2.00024x        | infx             |
| 9         | 256 x 256 x 257        | 0.0310001      | 0.0319998        | 0                 | 0.96876x        | infx             |

#### Block size = 64, OMP_NUM_THREADS = 8

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked Time (s) | Parallel Time (s) | Blocked Speedup | Parallel Speedup |
|-----------|------------------------|----------------|------------------|-------------------|-----------------|------------------|
| 0         | 64 x 64 x 64           | 0.00200009     | 0.000999928      | 0.00100017        | 2.00024x        | 1.99976x         |
| 1         | 128 x 64 x 128         | 0.00199986     | 0.00999999       | 0                 | 0.199986x       | infx             |
| 2         | 100 x 128 x 56         | 0.00199986     | 0.00200009       | 0.00300002        | 0.999881x       | 0.666614x        |
| 3         | 128 x 64 x 128         | 0              |  0.000999928     | 0.00200009        | 0x              | 0x               |
| 4         | 32 x 128 x 32          | 0              | 0                | 0.00200009        | NaN             | 0x               |
| 5         | 200 x 100 x 256        | 0.0120001      | 0.00999999       | 0.00400019        | 1.20001x        | 2.99988x         |
| 6         | 256 x 256 x 256        | 0.0379999      | 0.0369999        | 0.00899982        | 1.02703x        | 4.22229x         |
| 7         | 256 x 300 x 256        | 0.04           | 0.049            | 0.00900006        | 0.816325x       | 4.44441x         |
| 8         | 64 x 128 x 64          | 0              | 0                | 0.00499988        | NaN             | 0x               |
| 9         | 256 x 256 x 257        | 0.04           | 0.0349998        | 0.00999999        | 1.14286x        | 4x               |