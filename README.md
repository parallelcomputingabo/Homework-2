# Parallel Programming

**Åbo Akademi University, Information Technology Department**

**Instructor: Alireza Olama**

## Homework Assignment 2: Optimizing Matrix Multiplication in C++

### Results

This whole table gets pretty long for each row since I'm testing with 5 different block sizes ( 8, 16, 32, 64, 128 ) and with 4 different numbers of threads ( 2, 4, 8, 16, my computer has an
AMD Ryzen™ 7 5800H cpu which contains 8 CPU cores and 16 threads ).
I had already hard-coded blocked calculation with different block sizes into the code, and then I test with different numbers of threads by executing with commands like:

```bash
export OMP_NUM_THREADS=2 && ./matmul 0
```

Because for each test case I need to test out 4 different thread numbers by running 4 times, therefore I guess for the sake of simplicity in the following table the Naive time and all the blocked time would only be the last time I run the program with 16 threads...at least that was what I though....

Then I found that every time I execute the program on the same test case all the execution time is different, which made my results make no sense at all, so I had to modify the `parallel_matmul` function to set the number of the threads, so that I only need to run the program once ( like `$./matmul 0` ) to get all the results of that specific test case.

Then here's the results I got:

| Test Case | Dimensions (m × n × p) | Naive Time (s) | Blocked (8) Time (s) | Blocked (16) Time (s) | Blocked (32) Time (s) | Blocked (64) Time (s) | Blocked (128) Time (s) | Parallel (2 threads) Time (s) | Parallel (4 threads) Time (s) | Parallel (8 threads) Time (s) | Parallel (16 threads) Time (s) | Blocked (8) Speedup | Blocked (16) Speedup | Blocked (32) Speedup | Blocked (64) Speedup | Blocked (128) Speedup | Parallel (2 threads) Speedup | Parallel (4 threads) Speedup | Parallel (8 threads) Speedup | Parallel (16 threads) Speedup |
| --------- | ------------------------ | -------------- | -------------------- | --------------------- | --------------------- | --------------------- | ---------------------- | ----------------------------- | ----------------------------- | ----------------------------- | ------------------------------ | ------------------- | -------------------- | -------------------- | -------------------- | --------------------- | ---------------------------- | ---------------------------- | ---------------------------- | ----------------------------- |
| 0         | 64x64x64                 | 0.000771646    | 0.0011353            | 0.00106613            | 0.00105391            | 0.00103871            | 0.00106295             | 0.000592247                   | 0.000543011                   | 0.00057743                    | 0.00416798                     | 0.679686x           | 0.723784x            | 0.732175x            | 0.742889x            | 0.725945x             | 1.30291x                     | 1.42105x                     | 1.33635x                     | 0.185137x                     |
| 1         | 128x64x128               | 0.00322026     | 0.00494219           | 0.00457708            | 0.00430424            | 0.00435753            | 0.00459175             | 0.00200333                    | 0.00116642                    | 0.000974768                   | 0.0092046                      | 0.651586x           | 0.703564x            | 0.748161x            | 0.739012x            | 0.701315x             | 1.60745x                     | 2.7608x                      | 3.30362x                     | 0.349854x                     |
| 2         | 100x128x56               | 0.00225026     | 0.00409613           | 0.00356572            | 0.00310022            | 0.00305437            | 0.00289241             | 0.00129529                    | 0.000868726                   | 0.00103449                    | 0.00266196                     | 0.549362x           | 0.631081x            | 0.725838x            | 0.736735x            | 0.777988x             | 1.73726x                     | 2.5903x                      | 2.17523x                     | 0.84534x                      |
| 3         | 128x64x128               | 0.00315414     | 0.00575447           | 0.00438338            | 0.00434044            | 0.00437528            | 0.00468022             | 0.00194474                    | 0.00126332                    | 0.00110228                    | 0.00113642                     | 0.548121x           | 0.719569x            | 0.726689x            | 0.720901x            | 0.67393x              | 1.62189x                     | 2.49672x                     | 2.86148x                     | 2.77551x                      |
| 4         | 32x128x32                | 0.000392086    | 0.000577388          | 0.000531521           | 0.000500874           | 0.000540766           | 0.000497433            | 0.000374269                   | 0.000424789                   | 0.00045401                    | 0.00626618                     | 0.679068x           | 0.737668x            | 0.782804x            | 0.725057x            | 0.788219x             | 1.0476x                      | 0.923014x                    | 0.863607x                    | 0.0625717x                    |
| 5         | 200x100x256              | 0.0227305      | 0.0271641            | 0.022469              | 0.0221402             | 0.0217888             | 0.0221999              | 0.00907174                    | 0.00520066                    | 0.0027006                     | 0.00274182                     | 0.836786x           | 1.01164x             | 1.02666x             | 1.04322x             | 1.0239x               | 2.50564x                     | 4.3707x                      | 8.41686x                     | 8.2903x                       |
| 6         | 256x256x256              | 0.0561899      | 0.0863531            | 0.12813               | 0.075368              | 0.0913475             | 0.0708557              | 0.0296018                     | 0.0172644                     | 0.0117392                     | 0.0082478                      | 0.6507x             | 0.43854x             | 0.745541x            | 0.615123x            | 0.79302x              | 1.89819x                     | 3.25466x                     | 4.78651x                     | 6.81272x                      |
| 7         | 256x300x256              | 0.0676238      | 0.0972864            | 0.086496              | 0.0847436             | 0.086361              | 0.0843713              | 0.0357123                     | 0.0202628                     | 0.0106262                     | 0.00924776                     | 0.6951x             | 0.781813x            | 0.797981x            | 0.783036x            | 0.801502x             | 1.89357x                     | 3.33734x                     | 6.36388x                     | 7.31245x                      |
| 8         | 64x128x64                | 0.0015731      | 0.00241749           | 0.00211694            | 0.00211896            | 0.00206529            | 0.00216167             | 0.00115807                    | 0.000696908                   | 0.000704469                   | 0.00521325                     | 0.650714x           | 0.743099x            | 0.742391x            | 0.761683x            | 0.727724x             | 1.35838x                     | 2.25725x                     | 2.23303x                     | 0.30175x                      |
| 9         | 256x256x257              | 0.0643574      | 0.0973744            | 0.0811213             | 0.0711193             | 0.0748115             | 0.0716874              | 0.0283617                     | 0.0144551                     | 0.00879736                    | 0.00677648                     | 0.660928x           | 0.793348x            | 0.904922x            | 0.860262x            | 0.897751x             | 2.26916x                     | 4.45223x                     | 7.31554x                     | 9.49717x                      |
